<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<script>
    // Create an object literal called personAccount
    // It has firstName, lastName, incomes, expenses properties
    // and it has totalIncome, totalExpense, accountInfo, addIncome, addExpense and accountBalance methods.
    // Incomes is a set of incomes and its description and expenses is a set of incomes and its description.
    let personAccount = {
        firstName: 'Jesus',
        lastName: 'Valera Reales',
        incomes: 50000,
        expenses: 4000,
        totalIncome: function () {
            return `${this.incomes} euros incomes`
        },
        totalExpense: function () {
            return `${this.expenses} euros expenses`
        },
        accountInfo: function () {
            return `This person account is from ${this.firstName} ${this.lastName}\n`
                + `That account has ${this.totalIncome()}\n`
                + `That account has ${this.totalExpense()}\n`
                + `${this.accountBalance()}`
        },
        addIncome: function (incomes) {
            this.incomes += incomes
        },
        addExpense: function (expenses) {
            this.expenses += expenses
        },
        accountBalance: function () {
            return `Account balance: ${this.incomes - this.expenses}`
        },
    }
    console.log(personAccount.accountInfo())
    console.log('+500 incomes. -4000 expenses...')
    personAccount.addIncome(500)
    personAccount.addExpense(-4000)
    console.log(personAccount.accountInfo())

    // Imagine you are getting the above users collection from a MongoDB database:
    const users = [
        {
            _id: 'ab12ex',
            username: 'Alex',
            email: 'alex@alex.com',
            password: '123123',
            createdAt: '08/01/2020 9:00 AM',
            isLoggedIn: false,
        },
        {
            _id: 'fg12cy',
            username: 'Asab',
            email: 'asab@asab.com',
            password: '123456',
            createdAt: '08/01/2020 9:30 AM',
            isLoggedIn: true,
        },
        {
            _id: 'zwf8md',
            username: 'Brook',
            email: 'brook@brook.com',
            password: '123111',
            createdAt: '08/01/2020 9:45 AM',
            isLoggedIn: true,
        },
        {
            _id: 'eefamr',
            username: 'Martha',
            email: 'martha@martha.com',
            password: '123222',
            createdAt: '08/01/2020 9:50 AM',
            isLoggedIn: false,
        },
        {
            _id: 'ghderc',
            username: 'Thomas',
            email: 'thomas@thomas.com',
            password: '123333',
            createdAt: '08/01/2020 10:00 AM',
            isLoggedIn: false,
        },
    ]

    // Create a function called signUp which allows user to add to the collection
    // If user exists, inform the user that he has already an account.
    let signUp = function (newUser) {
        let isEmailAvailable = true
        for (const user of users) {
            // email === PK
            if (user.email === newUser.email) {
                console.log('Email already taken!')
                isEmailAvailable = false
            }
        }

        if (isEmailAvailable) {
            newUser._id = Math.random().toString(36).substring(7)
            users.push(newUser)
            console.log(`User ${newUser.username} created!`)
        }
    }

    let newUser1 = {
        username: 'Alex',
        email: 'alex@alex.com',
        password: '123123',
        createdAt: '10/04/2021 10:00 AM',
        isLoggedIn: false,
    }
    let newUser2 = {
        username: 'Pepe',
        email: 'pepe@pepe.com',
        password: '123321',
        createdAt: '9/04/2021 15:00 PM',
        isLoggedIn: false,
    }
    signUp(newUser1)
    signUp(newUser2)

    // Create a function called signIn which allows user to sign in to the application
    let signIn = function (signInUser) {
        console.log(`SignIn user ${signInUser.email} ...`)
        for (const user of users) {
            if (
                user.email === signInUser.email
                && user.password === signInUser.password
            ) {
                user.isLoggedIn = true
            }
        }
    }
    console.log(`Is Alex logged in?`, users[0].isLoggedIn)
    let signInUser = {
        email: 'alex@alex.com',
        password: '123123',
    }
    signIn(signInUser)
    console.log(`Is Alex logged in?`, users[0].isLoggedIn)
</script>
</body>
</html>
